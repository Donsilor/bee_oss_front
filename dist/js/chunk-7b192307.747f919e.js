(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b192307"],{"4b78":function(e,t,r){"use strict";function l(e,t){return"force"===e?{0:"否",1:"是"}[t]:"release_type"===e?{0:"全量升级",1:"白名单",2:"黑名单"}[t]:"status"===e?{0:"禁用",1:"启用"}[t]:""}r.d(t,"a",(function(){return l}))},"5fff":function(e,t,r){"use strict";r.r(t);var l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"page-content config-page"},[r("el-row",[r("el-col",{attrs:{span:24}},[r("el-button",{on:{click:e.back}},[e._v(" 返回 ")]),r("el-button",{attrs:{type:"primary"},on:{click:e.addAppVer}},[e._v(" 录入版本 ")])],1)],1),r("el-table",{attrs:{data:e.list}},[r("el-table-column",{attrs:{label:"版本标题",prop:"title"}}),r("el-table-column",{attrs:{label:"版本号",prop:"version"}}),r("el-table-column",{attrs:{formatter:function(t,r,l){return e.formatValue("force",l)},label:"强制升级",prop:"force"}}),r("el-table-column",{attrs:{formatter:function(t,r,l){return e.formatValue("release_type",l)},label:"发布类型",prop:"release_type"}}),r("el-table-column",{attrs:{label:"升级数量限制",prop:"upgrade_limit"}}),r("el-table-column",{attrs:{label:"升级成功数",prop:"current_upgrade_count"}}),r("el-table-column",{attrs:{label:"创建时间",prop:"created_at"}}),r("el-table-column",{attrs:{label:"更新时间",prop:"updated_at"}}),r("el-table-column",{attrs:{width:"300px",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",{staticStyle:{"margin-bottom":"5px"}},[r("el-button",{attrs:{size:"mini"},on:{click:function(r){return e.view(t.row)}}},[e._v(" 查看 ")]),r("el-button",{attrs:{size:"mini"},on:{click:function(r){return e.edit(t.row)}}},[e._v(" 编辑 ")]),r("el-button",{attrs:{size:"mini"},on:{click:function(r){return e.del(t.row)}}},[e._v(" 删除 ")])],1),r("el-button",{attrs:{size:"mini"},on:{click:function(r){return e.setConf(t.row)}}},[e._v(" 升级设置 ")]),r("el-button",{attrs:{size:"mini"},on:{click:function(r){return e.setStatus(t.row)}}},[e._v(" "+e._s(1===t.row.status?"禁用":"启用")+" ")])]}}])})],1),r("div",{staticClass:"page-line"},[r("el-pagination",{attrs:{total:e.total,"page-size":e.limit,"current-page":e.currentPage,small:"",layout:"prev, pager, next"},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t},"current-change":e.onPageChange}})],1),r("el-dialog",{attrs:{visible:e.dialogVisible,title:e.isEdit?"编辑":"新增"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.onClose}},[r("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-width":"150px"}},[r("el-row",[r("el-form-item",{attrs:{label:"版本Title",prop:"title"}},[r("el-input",{attrs:{placeholder:""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),r("el-form-item",{attrs:{label:"版本号",prop:"version"}},[r("el-input",{attrs:{disabled:e.isEdit,placeholder:""},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1),r("el-form-item",{attrs:{label:"升级描述",prop:"description"}},[r("el-input",{attrs:{rows:3,type:"textarea",placeholder:""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),1!=e.appInfo.os_type?r("el-form-item",{attrs:{label:"appstore链接",prop:"download_url_object"}},[r("el-input",{attrs:{type:"text"},model:{value:e.form.download_url_object,callback:function(t){e.$set(e.form,"download_url_object",t)},expression:"form.download_url_object"}})],1):e._e(),1==e.appInfo.os_type?r("el-form-item",{attrs:{label:"上传固件包",prop:"download_url_object"}},[r("upload-file",{ref:"uploadFile",staticClass:"newButtonStyle",attrs:{"file-list":e.fileListObj},on:{uploadSuccess:e.getSuccessNews}})],1):e._e(),r("el-form-item",{attrs:{label:"上传img图片",prop:"img_url_object"}},[r("el-upload",{ref:"uploadFileImg",staticClass:"upload-demo",attrs:{action:e.corsUrls,"on-success":e.getUploadDataImg,data:e.uploadObj,limit:1,"file-list":e.fileListImg}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v(" 点击上传 ")])],1)],1),r("el-form-item",{attrs:{label:"是否强制升级",prop:"force"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.force,callback:function(t){e.$set(e.form,"force",t)},expression:"form.force"}},[r("el-option",{attrs:{value:1,label:"是"}}),r("el-option",{attrs:{value:0,label:"否"}})],1)],1),r("el-form-item",{attrs:{label:"升级数量限制",prop:"upgrade_limit"}},[r("el-input",{model:{value:e.form.upgrade_limit,callback:function(t){e.$set(e.form,"upgrade_limit",t)},expression:"form.upgrade_limit"}})],1),r("el-form-item",{attrs:{label:"版本状态",prop:"status"}},[r("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},[r("el-option",{attrs:{value:1,label:"启用"}}),r("el-option",{attrs:{value:0,label:"停用"}})],1)],1),r("el-form-item",{attrs:{label:"备注",prop:"note"}},[r("el-input",{attrs:{placeholder:""},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}})],1),r("el-form-item",[r("el-button",{on:{click:e.saveAppVer}},[e._v(" 确定 ")])],1)],1)],1),r("el-dialog",{attrs:{visible:e.pushBoxFlag,title:"升级设置"},on:{"update:visible":function(t){e.pushBoxFlag=t}}},[r("el-form",{attrs:{"label-width":"100px"}},[r("el-form-item",{attrs:{label:"升级类型",prop:"push_type"}},[r("el-select",{attrs:{placeholder:"选择类型"},model:{value:e.pushForm.release_type,callback:function(t){e.$set(e.pushForm,"release_type",t)},expression:"pushForm.release_type"}},[r("el-option",{attrs:{value:0,label:"全量升级"}}),r("el-option",{attrs:{value:1,label:"白名单"}}),r("el-option",{attrs:{value:2,label:"黑名单"}})],1)],1),e.pushForm.release_type?r("el-row",[r("el-form-item",{attrs:{label:"推送客户端",prop:"push_type"}},[r("el-radio-group",{model:{value:e.pushForm.terminal_type,callback:function(t){e.$set(e.pushForm,"terminal_type",t)},expression:"pushForm.terminal_type"}},[r("el-radio",{attrs:{label:1}},[e._v(" 输入uuid ")]),r("el-radio",{attrs:{label:0}},[e._v(" 上传csv压缩包 ")])],1)],1)],1):e._e(),e.pushForm.release_type&&e.pushForm.terminal_type?r("el-form-item",{attrs:{label:"uuid_list",prop:"uuid_list"}},[r("el-row",{attrs:{gutter:24}},[r("el-col",{staticStyle:{"padding-left":"0"},attrs:{span:17}},[r("el-input",{model:{value:e.pushForm.uuid_list,callback:function(t){e.$set(e.pushForm,"uuid_list",t)},expression:"pushForm.uuid_list"}})],1)],1),r("el-row",[r("span",{staticStyle:{"font-size":"12px",color:"#999"}},[e._v("可输入多个uuid，用逗号隔开")])])],1):e._e(),e.pushForm.release_type&&!e.pushForm.terminal_type?r("el-form-item",{attrs:{label:"uuid_csv",prop:"uuid_csv"}},[r("el-row",{attrs:{gutter:24}},[r("el-col",{staticStyle:{"padding-left":"0"},attrs:{span:17}},[r("el-upload",{ref:"uploadFile",staticClass:"upload-demo",attrs:{action:e.uuid_upload,data:e.uploadObj,"on-success":e.getUploadDataUUid,limit:1}},[r("el-button",{attrs:{size:"small",type:"primary"}},[e._v(" 点击上传 ")])],1)],1)],1)],1):e._e(),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.pushUpdateForm("pushForm")}}},[e._v(" 确定 ")])],1)],1)],1),r("el-dialog",{attrs:{visible:e.detailDialogVisible,title:"详情 - "+e.currentRow.title},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[r("el-row",[r("el-col",{attrs:{span:12}},[r("p",[e._v("版本号："+e._s(e.currentRow.version))]),r("p",[e._v("APP_ID："+e._s(e.currentRow.app_id))]),r("p",[e._v("描述："+e._s(e.currentRow.description))]),r("p",[e._v("固件URL："+e._s(e.currentRow.download_url_object))]),r("p",[e._v("固件MD5："+e._s(e.currentRow.download_file_md5))]),r("p",[e._v("固件大小："+e._s(e.currentRow.size))])]),r("el-col",{attrs:{span:12}},[r("p",[e._v("强制升级："+e._s(e.formatValue("force",e.currentRow.force)))]),r("p",[e._v("升级类型："+e._s(e.formatValue("release_type",e.currentRow.release_type)))]),r("p",[e._v("升级限制数量："+e._s(e.currentRow.upgrade_limit))]),r("p",[e._v("升级成功数量："+e._s(e.currentRow.current_upgrade_count))]),r("p",[e._v("状态："+e._s(e.formatValue("status",e.currentRow.status)))])])],1),r("el-row",[r("el-col",{attrs:{span:12}},[e._v(" 创建时间："+e._s(e.currentRow.created_at)+" ")]),r("el-col",{attrs:{span:12}},[e._v(" 更新时间："+e._s(e.currentRow.updated_at)+" ")])],1),r("el-row",{staticStyle:{padding:"20px 0"}},[r("el-table",{attrs:{data:e.uuidList}},[r("el-table-column",{attrs:{prop:"app_uuid",label:"app_uuid"}})],1),r("div",{staticClass:"page-line"},[r("el-pagination",{attrs:{total:e.uuidsTotal,"page-size":5,"current-page":e.uuidsCurrentPage,small:"",layout:"prev, pager, next"},on:{"update:currentPage":function(t){e.uuidsCurrentPage=t},"update:current-page":function(t){e.uuidsCurrentPage=t},"current-change":e.onUuidPageChange}})],1)],1)],1)],1)},a=[],s=(r("ac1f"),r("1276"),r("8e44")),i=r("c46c"),o=r("227d"),u=r("4b78"),n={components:{uploadFile:i["a"]},data:function(){return{list:[],total:0,currentPage:1,limit:10,form:{},isEdit:!1,dialogVisible:!1,detailDialogVisible:!1,fileListObj:[],fileListImg:[],corsUrls:Object(o["a"])()+"/oss_file_upload",uuid_upload:Object(o["a"])()+"/uuid_upload",uploadObj:{token:""},appInfo:JSON.parse(localStorage.getItem("CurrentAppVerInfo")),pushBoxFlag:!1,pushForm:{release_type:0,terminal_type:1,uuid_csv:"",uuid_list:""},currentRow:{},rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],version:[{required:!0,message:"请输入版本号",trigger:"blur"}],description:[{required:!0,message:"请输入升级描述",trigger:"blur"}],download_url_object:[{required:!0,message:"请上传固件包或appstore链接",trigger:"blur"}],img_url_object:[{required:!0,message:"请上传图片",trigger:"blur"}],force:[{required:!0,message:"请选择是否强制升级",trigger:"blur"}],status:[{required:!0,message:"请选择版本状态",trigger:"blur"}]},pushFormRules:{},uuidList:[],uuidsTotal:0,uuidsCurrentPage:1}},mounted:function(){try{this.uploadObj.token=JSON.parse(localStorage.getItem("localData")).user.info.token}catch(e){console.log(e)}this.getList()},methods:{back:function(){this.$router.go(-1)},getList:function(){var e=this;s["a"].getAppVerList({page:this.currentPage,limit:this.limit,app_id:this.appInfo.app_id}).then((function(t){e.total=t.data.result.total,e.currentPage=t.data.result.current_page,e.list=t.data.result.data}))},addAppVer:function(){this.isEdit=!1,this.dialogVisible=!0,this.form={},this.fileListImg=[],this.fileListObj=[];try{this.$refs.uploadFile.clearFiles()}catch(e){console.log(e)}},onPageChange:function(e){this.currentPage=e,this.getList()},saveAppVer:function(){var e=this;this.$refs.ruleForm.validate((function(t){if(t){var r=Object.assign({},e.form,{app_id:e.appInfo.app_id,user_id:""});s["a"].saveAppVer(r).then((function(t){e.dialogVisible=!1,e.$message.success("保存成功"),e.getList()}))}}))},edit:function(e){this.isEdit=!0,this.dialogVisible=!0,this.form=Object.assign({},e),console.log(e);var t=e["img_url_object"];if(this.fileListImg=[{name:t,url:t}],1===this.appInfo.os_type){var r=e["download_url_object"];this.fileListObj=[{name:r,url:r}]}},del:function(e){var t=this;this.$confirm("确定删除？").then((function(){s["a"].delAppVer({version_id:e.version_id}).then((function(){t.$message.success("删除成功"),t.getList()}))}))},view:function(e){this.currentRow=e,this.detailDialogVisible=!0,this.getUuidList()},getUploadDataImg:function(e){var t=e.result;this.form.img_url_object=t.object,this.$refs.ruleForm.validateField("img_url_object")},getUploadDataUUid:function(e){this.pushForm.uuid_csv=e.result},getSuccessNews:function(e){e&&(this.form.download_url_object=e.download_url_object,this.form.download_file_md5=e.download_file_md5,this.form.size=e.size,this.$refs.ruleForm.validateField("download_url_object"))},setConf:function(e){this.currentRow=e,this.pushBoxFlag=!0,this.pushForm.release_type=e.release_type,this.pushForm.uuid_list="",this.pushForm.uuid_csv=""},setStatus:function(e){var t=this;s["a"].setAppVerStatus({version_id:e.version_id,status:1===e.status?0:1}).then((function(){t.$message.success("操作成功"),t.getList()}))},pushUpdateForm:function(){var e=this,t={version_id:this.currentRow.version_id,release_type:this.pushForm.release_type};this.pushForm.release_type&&(1===this.pushForm.terminal_type?t.uuid_list=this.pushForm.uuid_list.split(","):0===this.pushForm.terminal_type&&(t.uuid_list=this.pushForm.uuid_csv)),s["a"].setAppVerUuids(t).then((function(){e.$message.success("设置成功"),e.pushBoxFlag=!1}))},onClose:function(){this.$refs.ruleForm.clearValidate()},formatValue:u["a"],getUuidList:function(){var e=this;s["a"].getAppVerUuids({page:this.uuidsCurrentPage,limit:5,version_id:this.currentRow.version_id}).then((function(t){e.uuidsTotal=t.data.result.total,e.uuidsCurrentPage=t.data.result.current_page,e.uuidList=t.data.result.data}))},onUuidPageChange:function(e){this.uuidsCurrentPage=e,this.getUuidList()}}},p=n,c=r("2877"),d=Object(c["a"])(p,l,a,!1,null,null,null);t["default"]=d.exports}}]);
//# sourceMappingURL=chunk-7b192307.747f919e.js.map