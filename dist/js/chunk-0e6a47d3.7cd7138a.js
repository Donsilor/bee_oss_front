(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0e6a47d3"],{"07ac":function(t,e,i){var n=i("23e7"),a=i("6f53").values;n({target:"Object",stat:!0},{values:function(t){return a(t)}})},"29f3":function(t,e,i){"use strict";var n=i("4c2e");i.n(n).a},"498a":function(t,e,i){"use strict";var n=i("23e7"),a=i("58a8").trim;n({target:"String",proto:!0,forced:i("e070")("trim")},{trim:function(){return a(this)}})},"4c2e":function(t,e,i){},"4e82":function(t,e,i){"use strict";var n=i("23e7"),a=i("1c0b"),o=i("7b0b"),s=i("d039"),c=i("b301"),r=[],l=r.sort,u=s((function(){r.sort(void 0)})),f=s((function(){r.sort(null)})),d=c("sort");n({target:"Array",proto:!0,forced:u||!f||d},{sort:function(t){return void 0===t?l.call(o(this)):l.call(o(this),a(t))}})},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,i){function n(t){return function(e){var i=String(a(e));return 1&t&&(i=i.replace(s,"")),2&t&&(i=i.replace(c,"")),i}}var a=i("1d80"),o="["+i("5899")+"]",s=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$");t.exports={start:n(1),end:n(2),trim:n(3)}},"659b":function(t,e,i){"use strict";i.r(e);var n=i("f1ed"),a=(i("c740"),i("d81d"),i("4e82"),i("07ac"),i("498a"),i("159b"),{components:{Upload:i("9dac").a},data:function(){return{validList:{type:2,width:[1125,1005,670,750],height:[528,471,314,352],tips:"尺寸：1125*528，1005*471，670*314，750*352， 支持jpg，png"},validDetail:{type:2,width:[1125,1005,670,750],height:[528,471,314,352],tips:"尺寸：1125*528，1005*471，670*314，750*352， 支持jpg，png"},categoryList:[],startModeList:[],judgeData:"",config:{checkList:[],content:{list:[]},list_pic:{normal:"",normal_object:""}},rules:{scene_name:[{required:!0,message:"请输入场景名称",trigger:"blur"}],"list_pic.normal":[{required:!0,message:"请选择列表配图",trigger:"change"}],detail_pic:[{required:!0,message:"请选择详情页配图",trigger:"change"}],mode_id:[{required:!0,message:"请选择启动模式"}],enable:[{required:!0,message:"请选择状态",trigger:"change"}],checkList:[{type:"array",required:!0,message:"至少选择一个设备",trigger:"change"}]}}},computed:{title:function(){var t="";switch(this.config.type){case"add":t="添加场景";break;case"modify":t="编辑场景";break;case"look":t="查看场景";break;default:t="查看场景"}return t}},watch:{"config.show":function(){var t=this;this.$nextTick((function(){t.$refs.form.clearValidate()}))}},mounted:function(){this.getCategoryList(),this.getStartModeList()},methods:{reg:function(t,e){var i=t.purchace_link.trim();this.categoryList[e].purchace_link=i},compare:function(t){return function(e,i){return e[t]-i[t]}},emitListData:function(t){this.config.list_pic.normal=t.download_url,this.config.list_pic.normal_object=t.object},emitDetailData:function(t){this.config.detail_pic=t.download_url,this.config.detail_pic_object=t.object},getStartModeList:function(){var t=this;this.$http.post(n.a+"iotscenemode/lists",{}).then((function(e){var i=e.data.result.list.sort(t.compare("order"));t.startModeList=[],i.forEach((function(e){1==+e.enable&&t.startModeList.push(e)}))}))},getCategoryList:function(){var t=this;this.$http.post(n.a+"iotscene/catelists",{}).then((function(e){t.allList=e.data.result.list}))},dealList:function(){var t=this,e=Object(n.b)(this.allList);if("add"===this.config.type)return this.categoryList=e,this.config.checkList=[],void(this.config.enable=0);var i=[],a=e,o=this.config.content.list;a.forEach((function(t){var e=o.findIndex((function(e){return t.category_id===e.category_id}));-1===e||(t.category_status="-1"===o[e].status?"":o[e].status+"",t.purchace_link=o[e].purchace_link),i.push(t)})),this.categoryList=i,this.config.checkList=[],this.config.content.list.forEach((function(e){t.config.checkList.push(e.category_id)}))},cancel:function(){this.config.show=!1,this.judgeData=""},submit:function(){var t=this;"look"!==this.config.type?this.$refs.form.validate((function(e){if(!e)return!1;var i=t.getParam();""===t.judgeData&&t.$http.post(n.a+"iotscene/save",i).then((function(e){t.$emit("refresh",!0),t.config.show=!1}))})):this.config.show=!1},getParam:function(){var t=this,e=Object(n.b)(this.config);return delete e.type,delete e.show,e.list_pic.normal=e.list_pic.normal_object,delete e.list_pic.normal_object,e.detail_pic=e.detail_pic_object,delete e.detail_pic_object,e.content.list=[],this.config.checkList.forEach((function(i){Object.values(t.categoryList).forEach((function(t){if(t.category_id===i){var a=Object(n.b)(t);a.category_status||0===a.category_status?a.status=+a.category_status:a.status=-1,delete a.category_status,e.content.list.push(a)}}))})),delete e.checkList,delete e.mode_name,e},handleCheckedChange:function(){this.config=Object.assign({},this.config),this.judgmentMethod()},handleSelectChange:function(){this.judgmentMethod()},judgmentMethod:function(){var t=this.getParam(),e="";t.content.list.map((function(t){"-1"===t.status&&(e="off")})),this.judgeData="off"!==e?"":"off"}}}),o=(i("29f3"),i("2877")),s={components:{Config:Object(o.a)(a,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.config.show,title:t.title},on:{"update:visible":function(e){return t.$set(t.config,"show",e)}}},[i("el-form",{ref:"form",attrs:{model:t.config,rules:t.rules,disabled:"look"===t.config.type,"label-width":"100px"}},[i("el-form-item",{attrs:{prop:"scene_name",label:"场景名称"}},[i("el-input",{model:{value:t.config.scene_name,callback:function(e){t.$set(t.config,"scene_name",e)},expression:"config.scene_name"}})],1),i("el-form-item",{attrs:{prop:"list_pic.normal",label:"列表配图"}},[i("el-input",{staticClass:"hide",model:{value:t.config.list_pic.normal,callback:function(e){t.$set(t.config.list_pic,"normal",e)},expression:"config.list_pic.normal"}}),i("Upload",{class:{"is-disabled":"look"===t.config.type},attrs:{"image-file":t.config.list_pic.normal,type:t.config.type,valid:t.validList,path:"scene/"},on:{emitImageData:t.emitListData}})],1),i("el-form-item",{attrs:{prop:"detail_pic",label:"详情页配图"}},[i("el-input",{staticClass:"hide",model:{value:t.config.detail_pic,callback:function(e){t.$set(t.config,"detail_pic",e)},expression:"config.detail_pic"}}),i("Upload",{class:{"is-disabled":"look"===t.config.type},attrs:{"image-file":t.config.detail_pic,type:t.config.type,valid:t.validDetail,path:"scene/"},on:{emitImageData:t.emitDetailData}})],1),i("el-form-item",{attrs:{prop:"mode_id",label:"启动模式"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.config.mode_id,callback:function(e){t.$set(t.config,"mode_id",e)},expression:"config.mode_id"}},[t._l(t.startModeList,(function(e){return[1==+e.enable?i("el-option",{key:e.mode_id,attrs:{label:e.mode_name,value:e.mode_id}}):t._e()]}))],2)],1),i("el-form-item",{attrs:{prop:"checkList",label:"选择设备"}},[i("el-checkbox-group",{on:{change:t.handleCheckedChange},model:{value:t.config.checkList,callback:function(e){t.$set(t.config,"checkList",e)},expression:"config.checkList"}},t._l(t.categoryList,(function(e,n){return i("div",{key:n,staticClass:"item"},[i("el-checkbox",{attrs:{label:e.category_id}},[t._v("选择")]),i("img",{staticClass:"icon",attrs:{src:e.category_icon,alt:""}}),i("span",{staticClass:"name"},[t._v(t._s(e.category_name))]),i("el-select",{attrs:{clearable:""},on:{change:t.handleSelectChange},model:{value:e.category_status,callback:function(i){t.$set(e,"category_status",i)},expression:"it.category_status"}},t._l(e.status,(function(t,e){return i("el-option",{key:e,attrs:{label:t,value:e}})})),1),i("div",{staticClass:"link"},[i("label",[t._v("预定链接:")]),i("el-input",{on:{change:function(i){return t.reg(e,n)}},model:{value:e.purchace_link,callback:function(i){t.$set(e,"purchace_link",i)},expression:"it.purchace_link"}})],1)],1)})),0),i("div",{directives:[{name:"show",rawName:"v-show",value:"off"===t.judgeData,expression:"judgeData === 'off'"}],staticClass:"tis"},[t._v("勾选的设备状态必填")])],1),i("el-form-item",{attrs:{label:"状态"}},[i("el-radio-group",{model:{value:t.config.enable,callback:function(e){t.$set(t.config,"enable",e)},expression:"config.enable"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.cancel}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)}),[],!1,null,"217528a0",null).exports},data:function(){return{list:[]}},mounted:function(){this.getList()},methods:{getList:function(){var t=this;this.$http.post(n.a+"iotscene/lists",{}).then((function(e){t.list=e.data.result.list})).catch((function(e){e&&e.msg?t.$message.error(e.msg):t.$message.error(e)}))},submitEdit:function(t){var e=this;this.$http.post(n.a+"iotscene/save",t).then((function(t){e.$message.info("操作成功"),e.getList()})).catch((function(t){t&&t.msg?e.$message.error(t.msg):e.$message.error(t),e.getList()}))},delete:function(t){var e=this;this.$http.post(n.a+"iotscene/del",{scene_id:t}).then((function(t){e.$message.info("删除成功"),e.getList()})).catch((function(t){t&&t.msg?e.$message.error(t.msg):e.$message.error(t)}))},dealUpdateParam:function(t,e){var i=Object(n.b)(this.list[t]);return i.enable=+!+e,i.list_pic.normal=i.list_pic.normal_object,delete i.list_pic.normal_object,i.detail_pic=i.detail_pic_object,delete i.detail_pic_object,i},handeEnableClick:function(t,e){var i=this,n="禁用";e||(n="启用"),this.$confirm("您是否确定".concat(n,"该场景？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var n=i.dealUpdateParam(t,e);i.submitEdit(n)})).catch((function(){i.$message.info("已取消")}))},handeDeleteClick:function(t){var e=this;this.$confirm("您是否确定删除该场景？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.delete(t)})).catch((function(){e.$message.info("已取消")}))},handPageChange:function(t){this.pages.page=t,this.getList()},indexMethod:function(t){return t+1},showConfig:function(t,e){var i={type:t,show:!0,scene_name:"",list_pic:{normal:""},detail_pic:"",mode_id:"",enable:1,content:{list:[]}};this.$refs.configDialog.config="add"===t?i:Object.assign({},i,e),this.$refs.configDialog.dealList()},refresh:function(t){t&&this.getList()}}},c=(i("c26e"),Object(o.a)(s,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-content"},[i("div",{staticClass:"filter"},[i("span",[t._v("场景管理")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.showConfig("add")}}},[t._v("添加场景")])],1),i("div",[i("el-table",{attrs:{data:t.list,border:""}},[i("el-table-column",{attrs:{index:t.indexMethod,type:"index",label:"序号",width:"80"}}),i("el-table-column",{attrs:{prop:"scene_name",label:"场景名称"}}),i("el-table-column",{attrs:{prop:"mode_name",label:"启动方式"}}),i("el-table-column",{attrs:{prop:"created_at",label:"添加时间"}}),i("el-table-column",{attrs:{prop:"enable",label:"是否启用"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{class:e.row.enable?"red":""},[t._v(t._s(e.row.enable?"启用":"禁用"))])]}}])}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.showConfig("look",e.row)}}},[t._v("查看")]),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.showConfig("modify",e.row)}}},[t._v("编辑")]),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.handeEnableClick(e.$index,e.row.enable)}}},[t._v(" "+t._s(e.row.enable?"禁用":"启用")+" ")]),i("el-button",{attrs:{disabled:!!e.row.enable,type:"text",size:"small"},on:{click:function(i){return t.handeDeleteClick(e.row.scene_id)}}},[t._v("删除")])]}}])})],1)],1),i("Config",{ref:"configDialog",on:{refresh:t.refresh}})],1)}),[],!1,null,"83e10ba0",null));e.default=c.exports},"6f53":function(t,e,i){function n(t){return function(e){for(var i,n=s(e),r=o(n),l=r.length,u=0,f=[];u<l;)i=r[u++],a&&!c.call(n,i)||f.push(t?[i,n[i]]:n[i]);return f}}var a=i("83ab"),o=i("df75"),s=i("fc6a"),c=i("d1e7").f;t.exports={entries:n(!0),values:n(!1)}},c26e:function(t,e,i){"use strict";var n=i("c8e2");i.n(n).a},c740:function(t,e,i){"use strict";var n=i("23e7"),a=i("b727").findIndex,o=i("44d2"),s="findIndex",c=!0;s in[]&&Array(1)[s]((function(){c=!1})),n({target:"Array",proto:!0,forced:c},{findIndex:function(t,e){return a(this,t,1<arguments.length?e:void 0)}}),o(s)},c8e2:function(t,e,i){},e070:function(t,e,i){var n=i("d039"),a=i("5899");t.exports=function(t){return n((function(){return!!a[t]()||"​᠎"!="​᠎"[t]()||a[t].name!==t}))}}}]);