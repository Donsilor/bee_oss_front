(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e8274da4"],{"480b":function(t,e,o){"use strict";var r=o("f27e"),i=o.n(r);i.a},a4b5:function(t,e,o){"use strict";o.r(e);var r=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"page-content config-page"},[o("el-row",{attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:12}},[o("el-button-group",[o("el-button",{on:{click:t.openImportLayer}},[t._v(" 录入版本 "),o("i",{staticClass:"el-icon-caret-bottom"})]),o("el-button",{on:{click:t.openFilterFormLayer}},[t._v(" 匹配搜索 "),o("i",{staticClass:"el-icon-caret-bottom"})])],1)],1)],1),o("div",{staticClass:"p-r",staticStyle:{height:"40px","padding-top":"10px"}},[o("el-button",{staticClass:"btn-back",attrs:{type:"text"},on:{click:t.backToList}},[t._v(" 返回上一级 ")]),3===t.inputType||8===t.inputType?[o("el-tabs",{on:{"tab-click":t.deviceRouterChange},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"子设备列表",name:"devices"}}),o("el-tab-pane",{attrs:{label:"子路由列表",name:"routers"}})],1)]:t._e()],2),o("el-table",{staticStyle:{width:"100%","border-top":"0 none"},attrs:{data:t.versionList.tableData}},[t._l(t.versionList.tableColumn,(function(e){return o("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,width:"auto",align:"center"},scopedSlots:t._u([{key:"default",fn:function(r){return["type"==e.prop?o("div",[t._v(" "+t._s(t.getTypeText(r.row.type,r.row.os_type))+" ")]):"status"==e.prop?o("div",[t._v(" "+t._s(t.getStatusText(r.row.status))+" ")]):"force"==e.prop?o("div",[t._v(" "+t._s(t.getForceText(r.row.force))+" ")]):"is_pre_release"==e.prop?o("div",[t._v(" "+t._s(t.getPreReleaseText(r.row.is_pre_release))+" ")]):"gray"==e.prop?o("div",[t._v(" "+t._s(t.getGrayStatus[r.row.gray])+" ")]):"release_time"===e.prop?o("div",[t._v(" "+t._s(t.formatTime(r.row["created_at"]))+" ")]):o("div",[t._v(" "+t._s(r.row[e.prop])+" ")])]}}],null,!0)})})),13==t.inputType?o("el-table-column",{attrs:{width:"auto",prop:"rule",align:"center",label:"适用语音APP版本"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row["rule"])+" ")]}}],null,!1,714112091)}):t._e(),o("el-table-column",{attrs:{width:250,label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.getVersionDetail(e.row)}}},[t._v(" 查看 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.openSupportLayer(e.row)}}},[t._v(" 支持版本 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.openVersionEdit(e.row)}}},[t._v(" 编辑 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.startStopVerion(e.row)}}},[t._v(" "+t._s(e.row["status"]?"禁用":"启用")+" ")]),o("br"),"8"!=e.row.type?o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.openPushLayer(e.row)}}},[t._v(" 推送 ")]):t._e(),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.getOperateLog(e.row)}}},[t._v(" 操作日志 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.rollBackVersion(e.row)}}},[t._v(" 回滚 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.deleteVersion(e.row)}}},[t._v(" 删除 ")]),"8"!=e.row.type?o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.deleteUUID(e.row)}}},[t._v(" 清空UUID ")]):t._e()]}}])})],2),o("div",{staticClass:"page-line"},[o("el-pagination",{attrs:{total:t.totalItem_two,"page-size":10,"current-page":t.currentPage_two,small:"",layout:"prev, pager, next"},on:{"update:currentPage":function(e){t.currentPage_two=e},"update:current-page":function(e){t.currentPage_two=e},"current-change":t.pageChange_two}})],1),o("el-dialog",{attrs:{visible:t.filterPopoverFlag,title:"版本匹配搜索"},on:{"update:visible":function(e){t.filterPopoverFlag=e}}},[o("filter-form",{key:"filterForms",ref:"filterForms",attrs:{type:t.type,"brand-idoptions":t.brandIDOptions,"type-idoptions":t.typeIDOptions,"product-idoptions":t.productIDOptions,"input-type":t.inputType,product:t.product,router:t.router},on:{filterVersionsParent:t.filterVersions,closeFilterBox:function(e){t.filterPopoverFlag=!1}}})],1),o("el-dialog",{attrs:{visible:t.infoBoxFlag,title:"版本详情"},on:{"update:visible":function(e){t.infoBoxFlag=e}}},[o("version_detail",{ref:"versionDetails",attrs:{"rule-form-detail":t.ruleFormDetail,"device-obj":t.currentDetailObj}}),o("div",{staticStyle:{"text-align":"right",margin:"0"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.infoBoxFlag=!1}}},[t._v(" 确定 ")])],1)],1),o("el-dialog",{attrs:{title:t.addEditFlag?"录入版本":"编辑版本",visible:t.importBoxFlag},on:{"update:visible":function(e){t.importBoxFlag=e}}},[o("version-input",{key:"versionInputs",ref:"versionInputs",attrs:{flag:t.flag,"brand-idoptions":t.brandIDOptions,"type-idoptions":t.typeIDOptions,"product-idoptions":t.productIDOptions,"os-version-list":t.osVersionList,"input-type":t.inputType,product:t.product,type:t.type,router_pid:t.router_pid,os_type:t.os_type,"add-edit-flag":t.addEditFlag,"edit-data-obj":t.editDataObj,"released-flag":t.releasedFlag,"router-pid-list":t.routerPidList,"active-name":t.activeName},on:{importSubmitParent:t.importSubmit,closeImportBox:function(e){t.importBoxFlag=!1}}})],1),o("el-dialog",{attrs:{visible:t.pushBoxFlag,title:"推送升级"},on:{"update:visible":function(e){t.pushBoxFlag=e}}},[o("push-update",{ref:"pushUpdates",attrs:{type:t.type,"input-type":t.inputType,"push-data-obj":t.pushDataObj},on:{pushUpdateParent:t.pushUpdate,closePushBox:function(e){t.pushBoxFlag=!1}}})],1),o("el-dialog",{attrs:{visible:t.operateLogLayer,title:"操作日志"},on:{"update:visible":function(e){t.operateLogLayer=e}}},[o("operate_log",{attrs:{"operate-log-list":t.operateLogList}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{border:"none"},on:{click:function(e){t.operateLogLayer=!1}}},[t._v("取 消")])],1)],1),o("el-dialog",{attrs:{visible:t.supportLayer,title:"支持版本"},on:{"update:visible":function(e){t.supportLayer=e}}},[o("version-mapping",{ref:"supportLayer",attrs:{"input-type":t.inputType}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{border:"none"},on:{click:function(e){t.supportLayer=!1}}},[t._v("取 消")])],1)],1)],1)},i=[],n=(o("a4d3"),o("4de4"),o("d81d"),o("b0c0"),o("e439"),o("dbb4"),o("b64b"),o("159b"),o("ade3")),s=o("b0b0"),a=o("2f62"),p=(o("f1ed"),o("de48")),l=o("f0bd"),u=o("9008"),c=o("0786"),d=o("b333"),f=o("a772"),b=o("6cd5"),_=o("3589"),g=o("8e44");function v(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}function y(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?v(Object(o),!0).forEach((function(e){Object(n["a"])(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):v(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var h=y({components:{"version-input":u["a"],"push-update":c["a"],version_detail:d["a"],operate_log:f["a"],"filter-form":b["a"],"version-mapping":_["a"]},filters:{typeToString:function(t){return 1*t===1?"APP":1*t===2?"路由器":1*t===3?"子设备":"未知"},forceToString:function(t){return t?"是":"否"},statusToString:function(t){return t?"启用":"停用"}},data:function(){return{supportLayer:!1,firstTableShow:!0,pushBoxFlag:!1,info:{},importBoxFlag:!1,filterPopoverFlag:!1,infoBoxFlag:!1,totalItem:0,totalItem_two:0,currentPage:1,currentPage_two:1,filterTypeOptions:[{value:2,label:"路由器"},{value:3,label:"子设备"}],brandIDOptions:[],typeIDOptions:[],productIDOptions:[],listParams:{method:"list_versions",page:1,limit:10,level:1},terminalOptions:[{value:"1",lable:"选项一"}],versionOptions:[{value:"1",lable:"选项一"}],osOptions:[{value:"1",lable:"选项一"}],osVersionList:[],versionsFirst:{},versionList:{},inputType:"",ruleFormDetail:{title:"",description:"",version:"",type:"",force:"",size:"",note:"",status:"",download_file_md5:"",download_url_object:"",img_url_object:"",created_at:"",updated_at:"",release_time:""},rulesDetail:{},suportDevice:[],pushHistoryList:{},pushDataObj:{},secondTitle:"",currentDataObj:{},currentDetailObj:{},operateLogLayer:!1,operateLogList:{},addEditFlag:!0,editDataObj:{},releasedFlag:!1,mappingData:{},router:[],os_type:"",routerPidList:[],os_type_text:{1:"android_app",4:"ios_app",6:"android_pad",11:"route_app",12:"video_app",13:"lua_app"},device_type_text:{2:"路由器",3:"子设备",5:"H5",7:"Android system"},getGrayStatus:{0:"无",1:"白名单",2:"黑名单",3:"全量"},activeName:"devices",router_pid:"",flag:!1}}},Object(a["mapActions"])(["getVersions","selectVersion","importSubmitAction","pushUpdateAction","getVersionDetailAction","pubilcCorsAction"]),{computed:y({},Object(a["mapGetters"])({brand:s["c"],type:s["t"],product:s["o"]})),watch:{filterPopoverFlag:function(t,e){t&&(this.brandIDOptions.length||(this.brandIDOptions=this.brand.map((function(t){return{label:t.brand_name,value:t.brand_id}}))),this.versionOptions=this.router)}},mounted:function(){this.$store.dispatch({type:s["l"]});try{var t=JSON.parse(sessionStorage.getItem("CurrentAppInfo"));this.router_pid=t.router_pid||"",this.getVersionHistory(t)}catch(e){this.$router.push({path:"/main/versionManager"})}this.getVersionList(),this.getOsVersionList()},methods:{getOsVersionList:function(){var t=this;g["a"].pubilcCorsAction({method:"released_versions",type:7}).then((function(e){t.osVersionList=e.result.map((function(t){return{label:t.version,value:t.version}}))}))},getVersionList:function(){var t=this;g["a"].getVersions(t.listParams).then((function(e){0===e.code&&t.$nextTick((function(){var o=e.result;t.setFirstVersionList(o)}))}))},setFirstVersionList:function(t){for(var e in t)if("router"===e)for(var o in this.routerPidList=[],t[e])this.routerPidList.push({label:o,value:o})},openSupportLayer:function(t){var e=this;this.supportLayer=!0,this.$nextTick((function(){e.$refs["supportLayer"].renderData(t)}))},openFilterFormLayer:function(){var t=this;this.filterPopoverFlag=!0,this.$nextTick((function(){t.$refs["filterForms"].resetFilterForm()}))},formatTime:function(t){return t||"------"},openVersionEdit:function(t){this.initBrandIDOptions(),this.filterPopoverFlag=!1;var e="";if(t.os_type)switch(t.os_type){case 1:e="android_app";break;case 4:e="ios_app";break;case 6:e="android_pad";break;case 11:e="route_app";break;case 12:e="video_app";break;case 13:e="lua_app";break;default:e=t.os_type;break}var o={method:"version_detail",type:t.type,version:t.version,product_id:t.product_id||"",os_type:e,router_pid:t.router_pid||""},r=this;g["a"].pubilcCorsAction(o).then((function(t){var e=t.result;r.releasedFlag=1===e.status,r.addEditFlag=!1,r.editDataObj=e,r.importBoxFlag=!0,r.$nextTick((function(){r.$refs["versionInputs"].resetImportForm(),r.$refs["versionInputs"].renderEditData()}))}))},startStopVerion:function(t){var e=this;e.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,os_type:e.os_type_text[t.os_type]||"",user_id:t.user_id,product_id:t.product_id,router_pid:t.router_pid,method:t["status"]?"disable":"enable"};g["a"].pubilcCorsAction(o).then((function(t){0===t.code&&(e.$message({type:"success",message:"操作成功!"}),e.getVersionHistory(e.currentDataObj,1))}))}))},getOperateLog:function(t){this.operateLogLayer=!0,this.operateLogList=l;var e=this,o={type:t.type,version:t.version,product_id:t.product_id,method:"history_operation_logs"};g["a"].pubilcCorsAction(o).then((function(t){0===t.code&&(e.operateLogList.tableData=t.result.items)}))},deleteVersion:function(t){var e=this;e.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,user_id:t.user_id,product_id:t.product_id||"",os_type:e.os_type_text[t.os_type]||"",router_pid:t.router_pid||"",method:"del_version"};g["a"].pubilcCorsAction(o).then((function(t){0===t.code&&(e.$message({type:"success",message:"删除成功!"}),e.getVersionHistory(e.currentDataObj,1))}))}))},rollBackVersion:function(t){var e=this;e.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,user_id:t.user_id,product_id:t.product_id,method:"rollback",os_type:e.os_type_text[t.os_type]||""};g["a"].pubilcCorsAction(o).then((function(t){0===t.code&&(e.$message({type:"success",message:"回滚成功!"}),e.getVersionHistory(e.currentDataObj,1))}))}))},deleteUUID:function(t){var e=this;this.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,user_id:t.user_id,product_id:t.product_id,os_type:e.os_type_text[t.os_type]||"",router_pid:t.router_pid,method:"uuid_del"};g["a"].pubilcCorsAction(o).then((function(t){0===t.code&&e.$message({type:"success",message:"清空UUID成功!"})}))}))},getVersionDetail:function(t){this.infoBoxFlag=!0,this.currentDetailObj=t;var e={method:"version_detail",type:t.type,version:t.version,product_id:t.product_id||"",os_type:this.os_type_text[t.os_type]||"",router_pid:t.router_pid||""},o=this;g["a"].pubilcCorsAction(e).then((function(t){o.ruleFormDetail=t.result})),o.$nextTick((function(){o.$refs["versionDetails"].resetList()}))},filterClearAll:function(){},rowChosed:function(t){this.infoBoxFlag=!0,this.info=t.row},initBrandIDOptions:function(){try{this.brandIDOptions.length||(this.brandIDOptions=this.brand.map((function(t){return{label:t.brand_name,value:t.brand_id}})))}catch(t){console.log(t)}},openImportLayer:function(){var t=this;this.addEditFlag=!0,this.releasedFlag=!1,this.initBrandIDOptions(),this.importBoxFlag=!0,this.filterPopoverFlag=!1,this.$nextTick((function(){t.$refs["versionInputs"].resetImportForm()}))},openPushLayer:function(t){var e=this;this.pushDataObj=t,this.initBrandIDOptions(),this.pushBoxFlag=!0,this.$nextTick((function(){e.$refs["pushUpdates"].resetPushForm()}))},importSubmit:function(t){var e=this;g["a"].pubilcCorsAction(t).then((function(t){0===t.code&&(e.$message.success(e.addEditFlag?"录入成功":"编辑成功"),e.importBoxFlag=!1,e.pageChange_two(1))})).catch((function(t){"该版本信息已存在"===t.message&&(e.flag=!0)})).then((function(){e.flag=!1}))},pushUpdate:function(t){var e=this;g["a"].pubilcCorsAction(t).then((function(t){0===t.code&&(e.$message.success("推送成功"),e.pushBoxFlag=!1,e.pageChange_two(1))}))},pageChange_two:function(t){t&&(this.currentPage_two=t),this.getVersionHistory(this.currentDataObj,this.currentPage_two)},filterVersions:function(t){var e=this;g["a"].pubilcCorsAction(t).then((function(t){if(0===t.code){e.filterPopoverFlag=!1,e.firstTableShow=!1;var o=t.result;e.versionList.tableData=o.items,e.versionList=p,e.totalItem=o.page.total}}))},getTypeText:function(t,e){var o="";return o=1===t?e:this.device_type_text[t],o},getStatusTextPush:function(t){var e="";switch(t){case 1:e="成功";break;case 0:e="失败";break;default:break}return e},getStatusText:function(t){var e="";switch(t){case 1:e="有效";break;case 0:e="无效";break;default:break}return e},getForceText:function(t){var e="";switch(t){case 3:e="不弹窗升级";break;case 1:e="强制升级";break;case 0:e="不强制";break;default:break}return e},getPreReleaseText:function(t){var e="";switch(t){case 1:e="灰度版本";break;case 0:e="正式版本";break;default:break}return e},getVersionHistoryList:function(t,e){var o={page:t,limit:10,level:2,os_type:e.os_type||"",router_pid:e.router_pid||"",type:e.type,product_id:e.product_id||""},r=this;g["a"].getVersions(o).then((function(t){if(0===t.code){var e=t.result;if(r.firstTableShow=!1,Array.isArray(e.items))p.tableData=e.items;else{var o=[];Object.keys(e.items).forEach((function(t){o.push(e.items[t])})),p.tableData=o}r.versionList=Object.assign({},p),r.totalItem_two=e.page.total}}))},getVersionHistory:function(t,e){this.currentDataObj=t,this.inputType=t.type,this.os_type=t.os_type||"",this.secondTitle=this.getVersionTitle(t),this.getVersionHistoryList(e,t)},getVersionTitle:function(t){var e="";return t.name?e=t.name+"-版本历史":3===t.type?e="子设备-"+t.product_id+"-版本历史":5===t.type&&(e="H5-"+t.product_id+"-版本历史"),e},backToList:function(){this.$router.go(-1)},getPidName:function(t){return 3===t.type||8===t.type||5===t.type?t.product_id?"--"+t.product_id:"":2===t.type&&t.router_pid?"--"+t.router_pid:""},deviceRouterChange:function(){this.currentDataObj.type="devices"===this.activeName?3:8,this.getVersionHistory(this.currentDataObj,1)}}}),m=h,x=(o("480b"),o("2877")),w=Object(x["a"])(m,r,i,!1,null,null,null);e["default"]=w.exports},de48:function(t){t.exports=JSON.parse('{"tableColumn":[{"prop":"title","label":"版本Title","width":239},{"prop":"version","label":"版本号"},{"prop":"release_time","label":"发布时间"},{"prop":"status","label":"版本状态"},{"prop":"gray","label":"名单标识"},{"prop":"force","label":"是否强制升级"}],"tableData":[]}')},f0bd:function(t){t.exports=JSON.parse('{"tableColumn":[{"prop":"id","label":"id"},{"prop":"username","label":"用户名"},{"prop":"operation_name","label":"操作"},{"prop":"created_at","label":"时间"}],"tableData":[]}')},f27e:function(t,e,o){}}]);
//# sourceMappingURL=chunk-e8274da4.3bd5820c.js.map