(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f571fa0c"],{"07ac":function(t,e,i){t.exports=i("1c0f")(317)},"29f3":function(t,e,i){"use strict";var a=i("4c2e"),n=i.n(a);n.a},"2b3d":function(t,e,i){t.exports=i("1c0f")(225)},"498a":function(t,e,i){t.exports=i("1c0f")(368)},"4c2e":function(t,e,i){},"4e82":function(t,e,i){t.exports=i("1c0f")(350)},"659b":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"page-content"},[i("div",{staticClass:"filter"},[i("span",[t._v("场景管理")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.showConfig("add")}}},[t._v("添加场景")])],1),i("div",[i("el-table",{attrs:{data:t.list,border:""}},[i("el-table-column",{attrs:{index:t.indexMethod,type:"index",label:"序号",width:"80"}}),i("el-table-column",{attrs:{prop:"scene_name",label:"场景名称"}}),i("el-table-column",{attrs:{prop:"mode_name",label:"启动方式"}}),i("el-table-column",{attrs:{prop:"created_at",label:"添加时间"}}),i("el-table-column",{attrs:{prop:"enable",label:"是否启用"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{class:e.row.enable?"red":""},[t._v(t._s(e.row.enable?"启用":"禁用"))])]}}])}),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.showConfig("look",e.row)}}},[t._v("查看")]),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.showConfig("modify",e.row)}}},[t._v("编辑")]),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return t.handeEnableClick(e.$index,e.row.enable)}}},[t._v(" "+t._s(e.row.enable?"禁用":"启用")+" ")]),i("el-button",{attrs:{disabled:!!e.row.enable,type:"text",size:"small"},on:{click:function(i){return t.handeDeleteClick(e.row.scene_id)}}},[t._v("删除")])]}}])})],1)],1),i("Config",{ref:"configDialog",on:{refresh:t.refresh}})],1)},n=[],o=i("f1ed"),s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{"close-on-click-modal":!1,visible:t.config.show,title:t.title},on:{"update:visible":function(e){return t.$set(t.config,"show",e)}}},[i("el-form",{ref:"form",attrs:{model:t.config,rules:t.rules,disabled:"look"===t.config.type,"label-width":"100px"}},[i("el-form-item",{attrs:{prop:"scene_name",label:"场景名称"}},[i("el-input",{model:{value:t.config.scene_name,callback:function(e){t.$set(t.config,"scene_name",e)},expression:"config.scene_name"}})],1),i("el-form-item",{attrs:{prop:"list_pic.normal",label:"列表配图"}},[i("el-input",{staticClass:"hide",model:{value:t.config.list_pic.normal,callback:function(e){t.$set(t.config.list_pic,"normal",e)},expression:"config.list_pic.normal"}}),i("Upload",{class:{"is-disabled":"look"===t.config.type},attrs:{"image-file":t.config.list_pic.normal,type:t.config.type,valid:t.validList,path:"scene/"},on:{emitImageData:t.emitListData}})],1),i("el-form-item",{attrs:{prop:"detail_pic",label:"详情页配图"}},[i("el-input",{staticClass:"hide",model:{value:t.config.detail_pic,callback:function(e){t.$set(t.config,"detail_pic",e)},expression:"config.detail_pic"}}),i("Upload",{class:{"is-disabled":"look"===t.config.type},attrs:{"image-file":t.config.detail_pic,type:t.config.type,valid:t.validDetail,path:"scene/"},on:{emitImageData:t.emitDetailData}})],1),i("el-form-item",{attrs:{prop:"mode_id",label:"启动模式"}},[i("el-select",{attrs:{clearable:"",placeholder:"请选择"},model:{value:t.config.mode_id,callback:function(e){t.$set(t.config,"mode_id",e)},expression:"config.mode_id"}},[t._l(t.startModeList,(function(e){return[1===+e.enable?i("el-option",{key:e.mode_id,attrs:{label:e.mode_name,value:e.mode_id}}):t._e()]}))],2)],1),i("el-form-item",{attrs:{prop:"checkList",label:"选择设备"}},[i("el-checkbox-group",{on:{change:t.handleCheckedChange},model:{value:t.config.checkList,callback:function(e){t.$set(t.config,"checkList",e)},expression:"config.checkList"}},t._l(t.categoryList,(function(e,a){return i("div",{key:a,staticClass:"item"},[i("el-checkbox",{attrs:{label:e.category_id}},[t._v("选择")]),i("img",{staticClass:"icon",attrs:{src:e.category_icon,alt:""}}),i("span",{staticClass:"name"},[t._v(t._s(e.category_name))]),i("el-select",{attrs:{clearable:""},on:{change:t.handleSelectChange},model:{value:e.category_status,callback:function(i){t.$set(e,"category_status",i)},expression:"it.category_status"}},t._l(e.status,(function(t,e){return i("el-option",{key:e,attrs:{label:t,value:e}})})),1),i("div",{staticClass:"link"},[i("label",[t._v("预定链接:")]),i("el-input",{on:{change:function(i){return t.reg(e,a)}},model:{value:e.purchace_link,callback:function(i){t.$set(e,"purchace_link",i)},expression:"it.purchace_link"}})],1)],1)})),0),i("div",{directives:[{name:"show",rawName:"v-show",value:"off"===t.judgeData,expression:"judgeData === 'off'"}],staticClass:"tis"},[t._v("勾选的设备状态必填")])],1),i("el-form-item",{attrs:{label:"状态"}},[i("el-radio-group",{model:{value:t.config.enable,callback:function(e){t.$set(t.config,"enable",e)},expression:"config.enable"}},[i("el-radio",{attrs:{label:1}},[t._v("启用")]),i("el-radio",{attrs:{label:0}},[t._v("禁用")])],1)],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.cancel}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1)},c=[],l=(i("c740"),i("d81d"),i("4e82"),i("07ac"),i("498a"),i("159b"),i("9dac")),r={components:{Upload:l["a"]},data:function(){return{validList:{type:2,width:[1125,1005,670,750],height:[528,471,314,352],tips:"尺寸：1125*528，1005*471，670*314，750*352， 支持jpg，png"},validDetail:{type:2,width:[1125,1005,670,750],height:[528,471,314,352],tips:"尺寸：1125*528，1005*471，670*314，750*352， 支持jpg，png"},categoryList:[],startModeList:[],judgeData:"",config:{checkList:[],content:{list:[]},list_pic:{normal:"",normal_object:""}},rules:{scene_name:[{required:!0,message:"请输入场景名称",trigger:"blur"}],"list_pic.normal":[{required:!0,message:"请选择列表配图",trigger:"change"}],detail_pic:[{required:!0,message:"请选择详情页配图",trigger:"change"}],mode_id:[{required:!0,message:"请选择启动模式"}],enable:[{required:!0,message:"请选择状态",trigger:"change"}],checkList:[{type:"array",required:!0,message:"至少选择一个设备",trigger:"change"}]}}},computed:{title:function(){var t="";switch(this.config.type){case"add":t="添加场景";break;case"modify":t="编辑场景";break;case"look":t="查看场景";break;default:t="查看场景"}return t}},watch:{"config.show":function(t){var e=this;this.$nextTick((function(){e.$refs["form"].clearValidate()}))}},mounted:function(){this.getCategoryList(),this.getStartModeList()},methods:{reg:function(t,e){var i=t.purchace_link.trim();this.categoryList[e].purchace_link=i},compare:function(t){return function(e,i){var a=e[t],n=i[t];return a-n}},emitListData:function(t){this.config.list_pic.normal=t.download_url,this.config.list_pic.normal_object=t.object},emitDetailData:function(t){this.config.detail_pic=t.download_url,this.config.detail_pic_object=t.object},getStartModeList:function(){var t=this;this.$http.post(o["a"]+"iotscenemode/lists",{}).then((function(e){var i=e.data.result.list.sort(t.compare("order"));t.startModeList=[],i.forEach((function(e){1===+e.enable&&t.startModeList.push(e)}))}))},getCategoryList:function(){var t=this;this.$http.post(o["a"]+"iotscene/catelists",{}).then((function(e){t.allList=e.data.result.list}))},dealList:function(){var t=this,e=Object(o["b"])(this.allList);if("add"===this.config.type)return this.categoryList=e,this.config.checkList=[],void(this.config.enable=0);var i=[],a=e,n=this.config.content.list;a.forEach((function(t){var e=n.findIndex((function(e){return t.category_id===e.category_id}));-1===e?i.push(t):(t.category_status="-1"===n[e].status?"":n[e].status+"",t.purchace_link=n[e].purchace_link,i.push(t))})),this.categoryList=i,this.config.checkList=[],this.config.content.list.forEach((function(e){t.config.checkList.push(e.category_id)}))},cancel:function(){this.config.show=!1,this.judgeData=""},submit:function(){var t=this;"look"!==this.config.type?this.$refs["form"].validate((function(e){if(!e)return!1;var i=t.getParam();""===t.judgeData&&t.$http.post(o["a"]+"iotscene/save",i).then((function(e){t.$emit("refresh",!0),t.config.show=!1}))})):this.config.show=!1},getParam:function(){var t=this,e=Object(o["b"])(this.config);return delete e["type"],delete e["show"],e.list_pic.normal=e.list_pic.normal_object,delete e["list_pic"]["normal_object"],e.detail_pic=e.detail_pic_object,delete e["detail_pic_object"],e.content.list=[],this.config.checkList.forEach((function(i){Object.values(t.categoryList).forEach((function(t){if(t.category_id===i){var a=Object(o["b"])(t);a["category_status"]||0===a["category_status"]?a["status"]=+a["category_status"]:a["status"]=-1,delete a["category_status"],e.content.list.push(a)}}))})),delete e["checkList"],delete e["mode_name"],e},handleCheckedChange:function(){this.config=Object.assign({},this.config),this.judgmentMethod()},handleSelectChange:function(){this.judgmentMethod()},judgmentMethod:function(){var t=this.getParam(),e="";t.content.list.map((function(t){"-1"===t.status&&(e="off")})),this.judgeData="off"!==e?"":"off"}}},u=r,d=(i("29f3"),i("2877")),f=Object(d["a"])(u,s,c,!1,null,"217528a0",null),h=f.exports,g={components:{Config:h},data:function(){return{list:[]}},mounted:function(){this.getList()},methods:{getList:function(){var t=this;this.$http.post(o["a"]+"iotscene/lists",{}).then((function(e){t.list=e.data.result.list})).catch((function(e){e&&e.msg?t.$message.error(e.msg):t.$message.error(e)}))},submitEdit:function(t){var e=this;this.$http.post(o["a"]+"iotscene/save",t).then((function(t){e.$message.info("操作成功"),e.getList()})).catch((function(t){t&&t.msg?e.$message.error(t.msg):e.$message.error(t),e.getList()}))},delete:function(t){var e=this;this.$http.post(o["a"]+"iotscene/del",{scene_id:t}).then((function(t){e.$message.info("删除成功"),e.getList()})).catch((function(t){t&&t.msg?e.$message.error(t.msg):e.$message.error(t)}))},dealUpdateParam:function(t,e){var i=Object(o["b"])(this.list[t]);return i.enable=+!+e,i.list_pic.normal=i.list_pic.normal_object,delete i["list_pic"]["normal_object"],i.detail_pic=i.detail_pic_object,delete i["detail_pic_object"],i},handeEnableClick:function(t,e){var i=this,a="禁用";e||(a="启用"),this.$confirm("您是否确定".concat(a,"该场景？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var a=i.dealUpdateParam(t,e);i.submitEdit(a)})).catch((function(){i.$message.info("已取消")}))},handeDeleteClick:function(t){var e=this;this.$confirm("您是否确定删除该场景？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.delete(t)})).catch((function(){e.$message.info("已取消")}))},handPageChange:function(t){this.pages.page=t,this.getList()},indexMethod:function(t){return t+1},showConfig:function(t,e){var i={type:t,show:!0,scene_name:"",list_pic:{normal:""},detail_pic:"",mode_id:"",enable:1,content:{list:[]}};"add"===t?(console.log(t),console.log(i),this.$refs.configDialog.config=i):this.$refs.configDialog.config=Object.assign({},i,e),this.$refs.configDialog.dealList()},refresh:function(t){t&&this.getList()}}},p=g,m=(i("c26e"),Object(d["a"])(p,a,n,!1,null,"83e10ba0",null));e["default"]=m.exports},"9dac":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.corsUrls,"show-file-list":!1,"on-success":t.handleAvatarSuccess,data:t.uploadObj,"before-upload":t.beforeAvatarUpload}},[t.imageFile?i("img",{staticClass:"avatar",attrs:{src:t.imageFile}}):i("i",{staticClass:"el-icon-plus avatar-uploader-icon"}),i("i",{staticClass:"clear el-icon-remove",on:{click:function(e){return e.stopPropagation(),t.clearImg(e)}}})]),i("div",{staticClass:"tips"},[t._v(" "+t._s(t.valid.tips)+" ")])],1)},n=[],o=(i("99af"),i("d3b7"),i("3ca3"),i("ddb0"),i("2b3d"),i("227d")),s={props:["imageFile","type","valid","path"],data:function(){var t={token:JSON.parse(localStorage.getItem("localData")).user.info.token};return this.path&&(t.path=this.path),{corsUrls:Object(o["a"])()+"/oss_file_upload",uploadObj:t}},methods:{handleAvatarSuccess:function(t){this.$emit("emitImageData",t.result)},beforeAvatarUpload:function(t){var e=this,i="image/jpeg"===t.type||"image/png"===t.type;if("1"===this.valid.type){var a=t.size/1024<500;return i||this.$message.error("只能上传jpg或者png格式!"),a||this.$message.error("大小不能超过 500kb!"),i&&a}if("2"===this.valid.type){var n=new Promise((function(i,a){var n=e.valid.width,o=e.valid.height,s=window.URL||window.webkitURL,c=new Image;c.onload=function(){var t=(c.width===n[0]?n[0]:c.width===n[1]?n[1]:c.width===n[2]?n[2]:"")&&(c.height===o[0]?o[0]:c.height===o[1]?o[1]:c.height===o[2]?o[2]:"");t?i():a(new Error("错误"))},c.src=s.createObjectURL(t)})).then((function(){return t}),(function(){return e.$message.error("图片尺寸限制为".concat(e.valid.width[0]?e.valid.width[0]+" x ":"").concat(e.valid.height[0]?e.valid.height[0]:"").concat(e.valid.width[1]?"，"+e.valid.width[1]+" x ":"").concat(e.valid.height[1]?e.valid.height[1]:"").concat(e.valid.width[2]?"，"+e.valid.width[2]+" x ":"").concat(e.valid.height[2]?e.valid.height[2]:"")),Promise.reject(new Error("错误"))}));return i&&n}return!0},clearImg:function(){if("look"===this.$props.type)return!1;this.$emit("emitImageData",{})}}},c=s,l=(i("9f2a"),i("2877")),r=Object(l["a"])(c,a,n,!1,null,null,null);e["a"]=r.exports},"9f2a":function(t,e,i){"use strict";var a=i("ed51"),n=i.n(a);n.a},c26e:function(t,e,i){"use strict";var a=i("c8e2"),n=i.n(a);n.a},c740:function(t,e,i){t.exports=i("1c0f")(336)},c8e2:function(t,e,i){},ed51:function(t,e,i){}}]);
//# sourceMappingURL=chunk-f571fa0c.58abbcd6.js.map