(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-3d7cead4"],{"38bc":function(t,e,o){},"5c56":function(t,e,o){"use strict";var i=o("38bc");o.n(i).a},cabf:function(t){t.exports=JSON.parse('{"tableColumn":[{"prop":"type","label":"产品类型"},{"prop":"version","label":"版本号"},{"prop":"title","label":"版本Title"},{"prop":"release_time","label":"发布时间"},{"prop":"force","label":"是否强制升级"}],"tableData":[]}')},d62d:function(t,e,o){"use strict";o.r(e),o("a4d3"),o("4de4"),o("c975"),o("d81d"),o("b0c0"),o("e439"),o("dbb4"),o("b64b"),o("159b");var i=o("ade3"),r=o("b0b0"),s=o("2f62"),n=(o("f1ed"),o("cabf")),a=o("de48"),p=o("f0bd"),l=o("9008"),u=o("0786"),c=o("b333"),d=o("a772"),f=o("6cd5"),b=o("3589"),v=o("8e44");function g(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,i)}return o}function y(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?g(Object(o),!0).forEach((function(e){Object(i.a)(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):g(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var _=y({components:{"version-input":l.a,"push-update":u.a,version_detail:c.a,operate_log:d.a,"filter-form":f.a,"version-mapping":b.a},filters:{typeToString:function(t){return 1*t==1?"APP":1*t==2?"路由器":1*t==3?"子设备":"未知"},forceToString:function(t){return t?"是":"否"},statusToString:function(t){return t?"启用":"停用"}},data:function(){return{supportLayer:!1,firstTableShow:!0,pushBoxFlag:!1,info:{},importBoxFlag:!1,filterPopoverFlag:!1,infoBoxFlag:!1,totalItem:0,totalItem_two:0,currentPage:1,currentPage_two:1,filterTypeOptions:[{value:2,label:"路由器"},{value:3,label:"子设备"}],brandIDOptions:[],typeIDOptions:[],productIDOptions:[],listParams:{method:"list_versions",page:1,limit:10,level:1},terminalOptions:[{value:"1",lable:"选项一"}],versionOptions:[{value:"1",lable:"选项一"}],osOptions:[{value:"1",lable:"选项一"}],versionsFirst:{},versionList:{},inputType:"",ruleFormDetail:{title:"",description:"",version:"",type:"",force:"",size:"",note:"",status:"",download_file_md5:"",download_url_object:"",img_url_object:"",created_at:"",updated_at:"",release_time:""},rulesDetail:{},suportDevice:[],pushHistoryList:{},pushDataObj:{},secondTitle:"",currentDataObj:{},currentDetailObj:{},operateLogLayer:!1,operateLogList:{},addEditFlag:!0,editDataObj:{},releasedFlag:!1,mappingData:{},router:[],os_type:"",routerPidList:[],os_type_text:{1:"android_app",4:"ios_app",6:"android_pad",13:"lua_app"},device_type_text:{2:"路由器",3:"子设备",5:"H5",7:"Android system"},getGrayStatus:{0:"无",1:"白名单",2:"黑名单",3:"全量"},activeName:"devices"}}},Object(s.b)(["getVersions","selectVersion","importSubmitAction","pushUpdateAction","getVersionDetailAction","pubilcCorsAction"]),{computed:y({},Object(s.c)({brand:r.c,type:r.t,product:r.o})),watch:{filterPopoverFlag:function(t){t&&(this.brandIDOptions.length||(this.brandIDOptions=this.brand.map((function(t){return{label:t.brand_name,value:t.brand_id}}))),this.versionOptions=this.router)}},mounted:function(){this.$store.dispatch({type:r.l}),this.getVersionList(1)},methods:{openSupportLayer:function(t){var e=this;this.supportLayer=!0,this.$nextTick((function(){e.$refs.supportLayer.renderData(t)}))},openFilterFormLayer:function(){var t=this;this.filterPopoverFlag=!0,this.$nextTick((function(){t.$refs.filterForms.resetFilterForm()}))},formatTime:function(t){return t||"------"},openVersionEdit:function(t){this.initBrandIDOptions(),this.filterPopoverFlag=!1;var e="";if(t.os_type)switch(t.os_type){case 1:e="android_app";break;case 4:e="ios_app";break;case 6:e="android_pad";break;default:e=t.os_type}var o={method:"version_detail",type:t.type,version:t.version,product_id:t.product_id||"",os_type:e,router_pid:t.router_pid||""},i=this;v.a.pubilcCorsAction(o).then((function(t){var e=t.result;i.releasedFlag=1===e.status,i.addEditFlag=!1,i.editDataObj=e,i.importBoxFlag=!0,i.$nextTick((function(){i.$refs.versionInputs.resetImportForm(),i.$refs.versionInputs.renderEditData()}))}))},startStopVerion:function(t){var e=this;e.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,os_type:e.os_type_text[t.os_type]||"",user_id:t.user_id,product_id:t.product_id,router_pid:t.router_pid,method:t.status?"disable":"enable"};v.a.pubilcCorsAction(o).then((function(t){0===t.code&&(e.$message({type:"success",message:"操作成功!"}),e.getVersionHistory(e.currentDataObj,1))}))}))},getOperateLog:function(t){this.operateLogLayer=!0,this.operateLogList=p;var e=this,o={type:t.type,version:t.version,product_id:t.product_id,method:"history_operation_logs"};v.a.pubilcCorsAction(o).then((function(t){0===t.code&&(e.operateLogList.tableData=t.result.items)}))},deleteVersion:function(t){var e=this;e.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,user_id:t.user_id,product_id:t.product_id||"",os_type:e.os_type_text[t.os_type]||"",router_pid:t.router_pid||"",method:"del_version"};v.a.pubilcCorsAction(o).then((function(t){0===t.code&&(e.$message({type:"success",message:"删除成功!"}),e.getVersionHistory(e.currentDataObj,1))}))}))},rollBackVersion:function(t){var e=this;e.$confirm("确定此操作吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var o={type:t.type,version:t.version,user_id:t.user_id,product_id:t.product_id,method:"rollback",os_type:e.os_type_text[t.os_type]||""};v.a.pubilcCorsAction(o).then((function(t){0===t.code&&(e.$message({type:"success",message:"回滚成功!"}),e.getVersionHistory(e.currentDataObj,1))}))}))},getVersionDetail:function(t){this.infoBoxFlag=!0;var e={method:"version_detail",type:(this.currentDetailObj=t).type,version:t.version,product_id:t.product_id||"",os_type:this.os_type_text[t.os_type]||"",router_pid:t.router_pid||""},o=this;v.a.pubilcCorsAction(e).then((function(t){o.ruleFormDetail=t.result})),o.$nextTick((function(){o.$refs.versionDetails.resetList()}))},filterClearAll:function(){},rowChosed:function(t){this.infoBoxFlag=!0,this.info=t.row},initBrandIDOptions:function(){this.brandIDOptions.length||(this.brandIDOptions=this.brand.map((function(t){return{label:t.brand_name,value:t.brand_id}})))},openImportLayer:function(){var t=this;this.addEditFlag=!0,this.releasedFlag=!1,this.initBrandIDOptions(),this.importBoxFlag=!0,this.filterPopoverFlag=!1,this.$nextTick((function(){t.$refs.versionInputs.resetImportForm()}))},openPushLayer:function(t){var e=this;this.pushDataObj=t,this.initBrandIDOptions(),this.pushBoxFlag=!0,this.$nextTick((function(){e.$refs.pushUpdates.resetPushForm()}))},importSubmit:function(t){var e=this;v.a.pubilcCorsAction(t).then((function(t){0===t.code&&(e.$message.success(e.addEditFlag?"录入成功":"编辑成功"),e.importBoxFlag=!1,e.getVersionList(1))}))},pushUpdate:function(t){var e=this;v.a.pubilcCorsAction(t).then((function(t){0===t.code&&(e.$message.success("推送成功"),e.pushBoxFlag=!1,e.getVersionList(1))}))},pageChange:function(){this.getVersionList(this.currentPage)},pageChange_two:function(){this.getVersionHistory(this.currentDataObj,this.currentPage_two)},filterVersions:function(t){var e=this;v.a.pubilcCorsAction(t).then((function(t){if(0===t.code){e.filterPopoverFlag=!1,e.firstTableShow=!1;var o=t.result;e.versionList.tableData=o.items,e.versionList=a,e.totalItem=o.page.total}}))},getVersionList:function(t){this.listParams.page=t,this.versionsFirst=Object.assign({},n);var e=this;v.a.getVersionsForSC(e.listParams).then((function(t){0===t.code&&(e.firstTableShow=!0,e.$nextTick((function(){var o=t.result;e.versionsFirst.tableData&&e.versionsFirst.tableData.length||e.setFirstVersionList(o)})))}))},setFirstVersionList:function(t){for(var e in this.versionsFirst.tableData=[],t)t[e].key=e,t[e].type=0<=e.indexOf("plugin")?10:9,this.versionsFirst.tableData.push(t[e])},getTypeText:function(t,e){return 1===t?e:this.device_type_text[t]},getStatusTextPush:function(t){var e="";switch(t){case 1:e="成功";break;case 0:e="失败"}return e},getStatusText:function(t){var e="";switch(t){case 1:e="有效";break;case 0:e="无效"}return e},getForceText:function(t){var e="";switch(t){case 3:e="不弹窗升级";break;case 1:e="强制升级";break;case 0:e="不强制"}return e},getPreReleaseText:function(t){var e="";switch(t){case 1:e="灰度版本";break;case 0:e="正式版本"}return e},getVersionHistoryList:function(t,e){var o={page:t,limit:10,level:2,os_type:this.os_type_text[e.os_type]||"",type:e.type},i=this;v.a.getVersionsForSC(o).then((function(t){if(0===t.code){var e=t.result;i.firstTableShow=!1,a.tableData=e.items,i.versionList=Object.assign({},a),i.totalItem_two=e.page.total}}))},getVersionHistory:function(t,e){this.currentDataObj=t,this.inputType=t.type,this.os_type=this.os_type_text[t.os_type]||"",this.secondTitle=this.getVersionTitle(t),this.getVersionHistoryList(e,t)},gotoHistoryList:function(t,e){3===t.type&&(this.activeName="devices"),this.currentPage_two=e,this.getVersionHistory(t,e)},getVersionTitle:function(t){var e="";return t.name?e=t.name+"-版本历史":3===t.type?e="子设备-"+t.product_id+"-版本历史":5===t.type&&(e="H5-"+t.product_id+"-版本历史"),e},backToList:function(){this.getVersionList(1)},getPidName:function(t){return 3===t.type||8===t.type||5===t.type?t.product_id?"--"+t.product_id:"":2===t.type&&t.router_pid?"--"+t.router_pid:""},deviceRouterChange:function(){this.currentDataObj.type="devices"===this.activeName?3:8,this.getVersionHistory(this.currentDataObj,1)}}}),h=(o("5c56"),o("2877")),m=Object(h.a)(_,(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"page-content config-page"},[o("el-table",{directives:[{name:"show",rawName:"v-show",value:t.firstTableShow,expression:"firstTableShow"}],staticStyle:{width:"100%"},attrs:{data:t.versionsFirst.tableData}},[t._l(t.versionsFirst.tableColumn,(function(e){return o("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,width:"auto"},scopedSlots:t._u([{key:"default",fn:function(i){return["type"===e.prop?o("div",[t._v(" "+t._s(i.row.key)+" ")]):"status"===e.prop?o("div",[t._v(" "+t._s(t.getStatusText(i.row.status))+" ")]):"force"===e.prop?o("div",[t._v(" "+t._s(t.getForceText(i.row.force))+" ")]):"release_time"===e.prop?o("div",[t._v(" "+t._s(t.formatTime(i.row.release_time))+" ")]):o("div",[t._v(" "+t._s(i.row[e.prop])+" ")])]}}],null,!0)})})),o("el-table-column",{attrs:{width:"180",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.gotoHistoryList(e.row,1)}}},[t._v(" 查看版本列表 ")])]}}])})],2),t.firstTableShow?t._e():o("div",[o("el-row",{attrs:{type:"flex",justify:"space-between"}},[o("el-col",{attrs:{span:12}},[o("el-button-group",[o("el-button",{on:{click:t.openImportLayer}},[t._v(" 录入版本 "),o("i",{staticClass:"el-icon-caret-bottom"})]),o("el-button",{on:{click:t.openFilterFormLayer}},[t._v(" 匹配搜索 "),o("i",{staticClass:"el-icon-caret-bottom"})])],1)],1)],1),o("div",{staticClass:"p-r",staticStyle:{height:"40px","padding-top":"10px"}},[o("el-button",{staticClass:"btn-back",attrs:{type:"text"},on:{click:t.backToList}},[t._v(" 返回上一级 ")]),3===t.inputType||8===t.inputType?[o("el-tabs",{on:{"tab-click":t.deviceRouterChange},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[o("el-tab-pane",{attrs:{label:"子设备列表",name:"devices"}}),o("el-tab-pane",{attrs:{label:"子路由列表",name:"routers"}})],1)]:t._e()],2),o("el-table",{staticStyle:{width:"100%","border-top":"0 none"},attrs:{data:t.versionList.tableData}},[t._l(t.versionList.tableColumn,(function(e){return o("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,width:"auto"},scopedSlots:t._u([{key:"default",fn:function(i){return["type"===e.prop?o("div",[t._v(" "+t._s(t.getTypeText(i.row.type,i.row.os_type))+" ")]):"status"===e.prop?o("div",[t._v(" "+t._s(t.getStatusText(i.row.status))+" ")]):"force"===e.prop?o("div",[t._v(" "+t._s(t.getForceText(i.row.force))+" ")]):"is_pre_release"===e.prop?o("div",[t._v(" "+t._s(t.getPreReleaseText(i.row.is_pre_release))+" ")]):"gray"===e.prop?o("div",[t._v(" "+t._s(t.getGrayStatus[i.row.gray])+" ")]):"release_time"===e.prop?o("div",[t._v(" "+t._s(t.formatTime(i.row.release_time))+" ")]):o("div",[t._v(" "+t._s(i.row[e.prop])+" ")])]}}],null,!0)})})),o("el-table-column",{attrs:{width:250,label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.getVersionDetail(e.row)}}},[t._v(" 查看 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.openSupportLayer(e.row)}}},[t._v(" 支持版本 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.openVersionEdit(e.row)}}},[t._v(" 编辑 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.startStopVerion(e.row)}}},[t._v(" "+t._s(e.row.status?"禁用":"启用")+" ")]),o("br"),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.getOperateLog(e.row)}}},[t._v(" 操作日志 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.rollBackVersion(e.row)}}},[t._v(" 回滚 ")]),o("el-button",{attrs:{type:"text",size:"small"},on:{click:function(o){return t.deleteVersion(e.row)}}},[t._v(" 删除 ")])]}}],null,!1,846303109)})],2),o("div",{staticClass:"page-line"},[o("el-pagination",{attrs:{total:t.totalItem_two,"page-size":10,"current-page":t.currentPage_two,small:"",layout:"prev, pager, next"},on:{"update:currentPage":function(e){t.currentPage_two=e},"update:current-page":function(e){t.currentPage_two=e},"current-change":t.pageChange_two}})],1)],1),o("el-dialog",{attrs:{visible:t.filterPopoverFlag,title:"版本匹配搜索"},on:{"update:visible":function(e){t.filterPopoverFlag=e}}},[o("filter-form",{key:"filterForms",ref:"filterForms",attrs:{type:t.type,"brand-idoptions":t.brandIDOptions,"type-idoptions":t.typeIDOptions,"product-idoptions":t.productIDOptions,"input-type":t.inputType,product:t.product,router:t.router},on:{filterVersionsParent:t.filterVersions,closeFilterBox:function(e){t.filterPopoverFlag=!1}}})],1),o("el-dialog",{attrs:{visible:t.infoBoxFlag,title:"版本详情"},on:{"update:visible":function(e){t.infoBoxFlag=e}}},[o("version_detail",{ref:"versionDetails",attrs:{"rule-form-detail":t.ruleFormDetail,"device-obj":t.currentDetailObj}}),o("div",{staticStyle:{"text-align":"right",margin:"0"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.infoBoxFlag=!1}}},[t._v(" 确定 ")])],1)],1),o("el-dialog",{attrs:{title:t.addEditFlag?"录入版本":"编辑版本",visible:t.importBoxFlag},on:{"update:visible":function(e){t.importBoxFlag=e}}},[o("version-input",{key:"versionInputs",ref:"versionInputs",attrs:{"brand-i-d-options":t.brandIDOptions,"type-idoptions":t.typeIDOptions,"product-idoptions":t.productIDOptions,"input-type":t.inputType,product:t.product,type:t.type,os_type:t.os_type,"add-edit-flag":t.addEditFlag,"edit-data-obj":t.editDataObj,"released-flag":t.releasedFlag,"router-pid-list":t.routerPidList,"active-name":t.activeName},on:{importSubmitParent:t.importSubmit,closeImportBox:function(e){t.importBoxFlag=!1}}})],1),o("el-dialog",{attrs:{visible:t.pushBoxFlag,title:"推送升级"},on:{"update:visible":function(e){t.pushBoxFlag=e}}},[o("push-update",{ref:"pushUpdates",attrs:{type:t.type,"input-type":t.inputType,"push-data-obj":t.pushDataObj},on:{pushUpdateParent:t.pushUpdate,closePushBox:function(e){t.pushBoxFlag=!1}}})],1),o("el-dialog",{attrs:{visible:t.operateLogLayer,title:"操作日志"},on:{"update:visible":function(e){t.operateLogLayer=e}}},[o("operate_log",{attrs:{"operate-log-list":t.operateLogList}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{border:"none"},on:{click:function(e){t.operateLogLayer=!1}}},[t._v("取 消")])],1)],1),o("el-dialog",{attrs:{visible:t.supportLayer,title:"支持版本"},on:{"update:visible":function(e){t.supportLayer=e}}},[o("version-mapping",{ref:"supportLayer",attrs:{"input-type":t.inputType}}),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{staticStyle:{border:"none"},on:{click:function(e){t.supportLayer=!1}}},[t._v("取 消")])],1)],1)],1)}),[],!1,null,null,null);e.default=m.exports},de48:function(t){t.exports=JSON.parse('{"tableColumn":[{"prop":"title","label":"版本Title","width":239},{"prop":"version","label":"版本号"},{"prop":"release_time","label":"发布时间"},{"prop":"status","label":"版本状态"},{"prop":"gray","label":"名单标识"},{"prop":"force","label":"是否强制升级"}],"tableData":[]}')},f0bd:function(t){t.exports=JSON.parse('{"tableColumn":[{"prop":"id","label":"id"},{"prop":"username","label":"用户名"},{"prop":"operation_name","label":"操作"},{"prop":"created_at","label":"时间"}],"tableData":[]}')}}]);